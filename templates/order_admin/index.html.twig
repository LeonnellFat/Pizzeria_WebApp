{% extends '_admin_layout.html.twig' %}

{% block title %}Order Management{% endblock %}

{% block page_title %}Order Management{% endblock %}
{% block page_subtitle %}View and manage all customer orders{% endblock %}

{% block admin_content %}
<!-- Header with Create Button -->
<div class="flex justify-between items-center mb-8">
  <div></div>
  <a href="{{ path('app_order_admin_new') }}" 
     class="px-6 py-3 bg-[#D62828] text-white rounded-lg hover:bg-red-700 transition font-semibold shadow-lg">
    ‚úö Create New Order
  </a>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-5 gap-6 mb-8">
  <!-- Total Orders Card -->
  <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-sm font-medium">Total Orders</p>
        <p class="text-3xl font-bold text-blue-600 mt-2">{{ totalOrders }}</p>
      </div>
      <div class="text-4xl text-blue-100">üìä</div>
    </div>
  </div>

  <!-- Total Revenue Card -->
  <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-sm font-medium">Total Revenue</p>
        <p class="text-3xl font-bold text-green-600 mt-2">${{ totalRevenue|number_format(2) }}</p>
      </div>
      <div class="text-4xl text-green-100">üí∞</div>
    </div>
  </div>

  <!-- On Process Card -->
  <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-sm font-medium">On Process</p>
        <p class="text-3xl font-bold text-yellow-600 mt-2">{{ onProcessCount }}</p>
      </div>
      <div class="text-4xl text-yellow-100">‚è±Ô∏è</div>
    </div>
  </div>

  <!-- Completed Card -->
  <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-sm font-medium">Completed</p>
        <p class="text-3xl font-bold text-purple-600 mt-2">{{ completedCount }}</p>
      </div>
      <div class="text-4xl text-purple-100">‚úì</div>
    </div>
  </div>

  <!-- Delivered Card -->
  <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-700">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-sm font-medium">Delivered</p>
        <p class="text-3xl font-bold text-green-700 mt-2">{{ deliveredCount }}</p>
      </div>
      <div class="text-4xl text-green-200">üöö</div>
    </div>
  </div>
</div>

<!-- Orders Table -->
<div class="bg-white rounded-lg shadow-lg overflow-hidden">
  <div class="p-6 border-b border-gray-200">
    <h2 class="text-2xl font-bold text-gray-800">Recent Orders</h2>
  </div>

  {% if orders|length > 0 %}
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-100 border-b">
          <tr>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Order ID</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Date</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Customer Name</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Phone</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Address</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Quantity</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Amount</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
            <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for order in orders %}
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-4 text-sm font-medium text-gray-900">#{{ order.id }}</td>
              <td class="px-6 py-4 text-sm text-gray-600">{{ order.createdAt ? order.createdAt|date('M d, Y') : 'N/A' }}</td>
              <td class="px-6 py-4 text-sm text-gray-900 font-medium">{{ order.customerName }}</td>
              <td class="px-6 py-4 text-sm text-gray-600">{{ order.customerPhone }}</td>
              <td class="px-6 py-4 text-sm text-gray-600">{{ order.customerAddress }}</td>
              <td class="px-6 py-4 text-sm text-gray-900">{{ order.totalQuantity }}</td>
              <td class="px-6 py-4 text-sm font-semibold text-green-600">${{ order.totalPrice|number_format(2) }}</td>
              <td class="px-6 py-4 text-sm">
                <form method="POST" action="{{ path('app_order_admin_update_status', {'id': order.id}) }}" class="inline-block">
                  <input type="hidden" name="_token" value="{{ csrf_token('status' ~ order.id) }}">
                  <select name="status" onchange="this.form.submit()" class="px-3 py-1 rounded-full text-sm font-medium border-2 focus:outline-none transition 
                    {% if order.status == 'On Process' or order.status == 'Preparing' %}
                      border-yellow-300 bg-yellow-50 text-yellow-700
                    {% elseif order.status == 'Completed' %}
                      border-purple-300 bg-purple-50 text-purple-700
                    {% elseif order.status == 'Delivered' %}
                      border-green-300 bg-green-50 text-green-700
                    {% elseif order.status == 'Cancelled' %}
                      border-red-300 bg-red-50 text-red-700
                    {% endif %}
                  ">
                    <option value="On Process" {% if order.status == 'On Process' %}selected{% endif %}>On Process</option>
                    <option value="Preparing" {% if order.status == 'Preparing' %}selected{% endif %}>Preparing</option>
                    <option value="Completed" {% if order.status == 'Completed' %}selected{% endif %}>Completed</option>
                    <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                    <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                  </select>
                </form>
              </td>
              <td class="px-6 py-4 text-sm space-x-3 flex items-center">
                <a href="{{ path('app_order_admin_show', {'id': order.id}) }}" 
                   class="text-blue-600 hover:text-blue-800 font-medium transition">View Details</a>
                
                <form method="POST" action="{{ path('app_order_admin_delete', {'id': order.id}) }}" class="inline" onsubmit="return confirm('Are you sure you want to delete this order?');">
                  <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ order.id) }}">
                  <button type="submit" class="text-red-600 hover:text-red-800 font-medium transition">Delete</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="p-6 text-center">
      <p class="text-gray-600 text-lg">No orders found.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
