{% extends '_admin_layout.html.twig' %}

{% block page_title %}Dashboard Overview{% endblock %}
{% block page_subtitle %}Get a quick snapshot of your pizzeria's performance{% endblock %}

{% block admin_content %}

<!-- Statistics Cards Section -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
  
  <!-- Total Orders Card -->
  <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-blue-500 hover:shadow-xl transition">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm font-semibold mb-2">Total Orders</p>
        <p class="text-3xl font-bold text-gray-800">{{ totalOrders }}</p>
      </div>
      <div class="text-4xl">üì¶</div>
    </div>
    <p class="text-gray-400 text-xs mt-4">All orders placed</p>
  </div>

  <!-- Total Revenue Card -->
  <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500 hover:shadow-xl transition">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm font-semibold mb-2">Total Revenue</p>
        <p class="text-3xl font-bold text-gray-800">‚Ç±{{ totalRevenue|number_format(2, '.', ',') }}</p>
      </div>
      <div class="text-4xl">üí∞</div>
    </div>
    <p class="text-gray-400 text-xs mt-4">Cumulative earnings</p>
  </div>

  <!-- Total Pizzas Card -->
  <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-red-500 hover:shadow-xl transition">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm font-semibold mb-2">Total Pizzas</p>
        <p class="text-3xl font-bold text-gray-800">{{ totalPizzas }}</p>
      </div>
      <div class="text-4xl">üçï</div>
    </div>
    <p class="text-gray-400 text-xs mt-4">Available pizza variants</p>
  </div>

  <!-- Total Categories Card -->
  <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-yellow-500 hover:shadow-xl transition">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm font-semibold mb-2">Total Categories</p>
        <p class="text-3xl font-bold text-gray-800">{{ totalCategories }}</p>
      </div>
      <div class="text-4xl">üè∑Ô∏è</div>
    </div>
    <p class="text-gray-400 text-xs mt-4">Pizza categories</p>
  </div>

  <!-- Total Ingredients Card -->
  <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-purple-500 hover:shadow-xl transition">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm font-semibold mb-2">Total Ingredients</p>
        <p class="text-3xl font-bold text-gray-800">{{ totalIngredients }}</p>
      </div>
      <div class="text-4xl">üßÇ</div>
    </div>
    <p class="text-gray-400 text-xs mt-4">Available ingredients</p>
  </div>

  <!-- Total Users Card -->
  <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-indigo-500 hover:shadow-xl transition">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 text-sm font-semibold mb-2">Total Users</p>
        <p class="text-3xl font-bold text-gray-800">{{ totalUsers }}</p>
      </div>
      <div class="text-4xl">üë•</div>
    </div>
    <p class="text-gray-400 text-xs mt-4">Registered customers</p>
  </div>

</div>

<!-- Revenue Summary Section -->
<div class="bg-white rounded-lg shadow-lg p-8 mb-8">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-bold text-gray-800">üíπ Revenue Summary</h2>
    
    <!-- Filter Buttons -->
    <div class="flex gap-3">
      <button onclick="loadRevenueChart('today')"
         class="filter-btn px-4 py-2 rounded-lg font-semibold transition {{ filter == 'today' ? 'bg-[#D62828] text-white shadow' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' }}"
         data-filter="today">
        Today
      </button>
      <button onclick="loadRevenueChart('this_week')"
         class="filter-btn px-4 py-2 rounded-lg font-semibold transition {{ filter == 'this_week' ? 'bg-[#D62828] text-white shadow' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' }}"
         data-filter="this_week">
        This Week
      </button>
      <button onclick="loadRevenueChart('this_month')"
         class="filter-btn px-4 py-2 rounded-lg font-semibold transition {{ filter == 'this_month' ? 'bg-[#D62828] text-white shadow' : 'bg-gray-100 text-gray-700 hover:bg-gray-200' }}"
         data-filter="this_month">
        This Month
      </button>
    </div>
  </div>

  <!-- Line Chart -->
  <div class="relative" style="height: 400px;">
    <canvas id="revenueChart"></canvas>
  </div>
</div>

<!-- Quick Actions Section -->
<div class="bg-white rounded-lg shadow-lg p-8">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">‚ö° Quick Actions</h2>
  
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    
    <!-- Pizza Management Quick Action -->
    <a href="{{ path('app_pizza_admin_index') }}"
       class="group bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 border-2 border-red-300 hover:border-red-500 transition cursor-pointer">
      <div class="text-5xl mb-4 group-hover:scale-110 transition">üçï</div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Pizza Management</h3>
      <p class="text-gray-600 text-sm mb-4">Add, edit, or remove pizza variants</p>
      <div class="flex items-center text-red-600 font-semibold">
        Manage Pizzas ‚Üí
      </div>
    </a>

    <!-- Category Management Quick Action -->
    <a href="{{ path('app_category_admin_index') }}"
       class="group bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-6 border-2 border-yellow-300 hover:border-yellow-500 transition cursor-pointer">
      <div class="text-5xl mb-4 group-hover:scale-110 transition">üè∑Ô∏è</div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Category Management</h3>
      <p class="text-gray-600 text-sm mb-4">Organize and manage pizza categories</p>
      <div class="flex items-center text-yellow-600 font-semibold">
        Manage Categories ‚Üí
      </div>
    </a>

    <!-- Ingredient Management Quick Action -->
    <a href="{{ path('app_ingredient_admin_index') }}"
       class="group bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 border-2 border-green-300 hover:border-green-500 transition cursor-pointer">
      <div class="text-5xl mb-4 group-hover:scale-110 transition">üßÇ</div>
      <h3 class="text-xl font-bold text-gray-800 mb-2">Ingredient Management</h3>
      <p class="text-gray-600 text-sm mb-4">Control ingredients and inventory</p>
      <div class="flex items-center text-green-600 font-semibold">
        Manage Ingredients ‚Üí
      </div>
    </a>

  </div>
</div>

<!-- Chart.js Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let revenueChartInstance = null;

  function loadRevenueChart(filter) {
    // Update filter buttons styling
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.classList.remove('bg-[#D62828]', 'text-white', 'shadow');
      btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
    });
    
    const activeBtn = document.querySelector(`[data-filter="${filter}"]`);
    activeBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
    activeBtn.classList.add('bg-[#D62828]', 'text-white', 'shadow');

    // Fetch new data
    fetch(`{{ path('app_overview_admin') }}?filter=${filter}&ajax=1`)
      .then(response => response.json())
      .then(data => {
        // Update chart with new data
        if (revenueChartInstance) {
          revenueChartInstance.data.labels = data.labels;
          revenueChartInstance.data.datasets[0].data = data.data;
          revenueChartInstance.update();
        }
      })
      .catch(error => console.error('Error loading revenue data:', error));
  }

  // Initialize chart on page load
  const revenueChartCtx = document.getElementById('revenueChart').getContext('2d');
  revenueChartInstance = new Chart(revenueChartCtx, {
    type: 'line',
    data: {
      labels: {{ revenueData.labels|json_encode|raw }},
      datasets: [{
        label: 'Revenue (‚Ç±)',
        data: {{ revenueData.data|json_encode|raw }},
        borderColor: '#D62828',
        backgroundColor: 'rgba(214, 40, 40, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4,
        pointRadius: 5,
        pointBackgroundColor: '#D62828',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        pointHoverRadius: 7,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          labels: {
            font: { size: 12, weight: 'bold' },
            usePointStyle: true,
            padding: 15
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            callback: function(value) {
              return '‚Ç±' + value.toFixed(0);
            },
            font: { size: 11 }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        x: {
          ticks: {
            font: { size: 11 }
          },
          grid: {
            display: false
          }
        }
      }
    }
  });
</script>

{% endblock %}

